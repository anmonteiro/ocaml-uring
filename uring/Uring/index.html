<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Uring (uring.Uring)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">uring</a> &#x00BB; Uring</nav><header class="odoc-preamble"><h1>Module <code><span>Uring</span></code></h1><p>Io_uring interface.</p></header><nav class="odoc-toc"><ul><li><a href="#fixed-buffers">Fixed buffers</a></li><li><a href="#queueing-operations">Queueing operations</a></li><li><a href="#timeout">Timeout</a></li><li><a href="#probing">Probing</a></li><li><a href="#submitting-operations">Submitting operations</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Region" class="anchored"><a href="#module-Region" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Region/index.html">Region</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Region</code> handles carving up a block of external memory into smaller chunks. This is currently just a slab allocator of a fixed size, on the basis that most IO operations operate on predictable chunks of memory. Since the block of memory in a region is contiguous, it can be used in Uring's fixed buffer model to map it into kernel space for more efficient IO.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p><code>'a t</code> is a reference to an Io_uring structure.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-job" class="anchored"><a href="#type-job" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a job</span></span></code></div><div class="spec-doc"><p>A handle for a submitted job, which can be used to cancel it. If an operation returns <code>None</code>, this means that submission failed because the ring is full.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>?polling_timeout:int <span class="arrow">&#45;&gt;</span></span> <span>queue_depth:int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create ~queue_depth</code> will return a fresh Io_uring structure <code>t</code>. Initially, <code>t</code> has no fixed buffer. Use <a href="#val-set_fixed_buffer"><code>set_fixed_buffer</code></a> if you want one.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">polling_timeout</span> <p>If given, use polling mode with the given idle timeout (in ms). This requires privileges.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-queue_depth" class="anchored"><a href="#val-queue_depth" class="anchor"></a><code><span><span class="keyword">val</span> queue_depth : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>queue_depth t</code> returns the total number of submission slots for the uring <code>t</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-exit" class="anchored"><a href="#val-exit" class="anchor"></a><code><span><span class="keyword">val</span> exit : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>exit t</code> will shut down the uring <code>t</code>. Any subsequent requests will fail.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if there are any requests in progress</p></li></ul></div></div><h3 id="fixed-buffers"><a href="#fixed-buffers" class="anchor"></a>Fixed buffers</h3><p>Each uring may have associated with it a fixed region of memory that is used for the &quot;fixed buffer&quot; mode of io_uring to avoid data copying between userspace and the kernel.</p><div class="odoc-spec"><div class="spec value" id="val-set_fixed_buffer" class="anchored"><a href="#val-set_fixed_buffer" class="anchor"></a><code><span><span class="keyword">val</span> set_fixed_buffer : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Cstruct</span>.buffer <span class="arrow">&#45;&gt;</span></span>
  <span><span>( unit, <span>[&gt; `ENOMEM ]</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>set_fixed_buffer t buf</code> sets <code>buf</code> as the fixed buffer for <code>t</code>.</p><p>You will normally want to wrap this with <a href="Region/index.html#val-alloc"><code>Region.alloc</code></a> or similar to divide the buffer into chunks.</p><p>If <code>t</code> already has a buffer set, the old one will be removed.</p><p>Returns <code>`ENOMEM</code> if insufficient kernel resources are available or the caller's RLIMIT_MEMLOCK resource limit would be exceeded.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if there are any requests in progress</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-buf" class="anchored"><a href="#val-buf" class="anchor"></a><code><span><span class="keyword">val</span> buf : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Cstruct</span>.buffer</span></code></div><div class="spec-doc"><p><code>buf t</code> is the fixed internal memory buffer associated with uring <code>t</code> using <a href="#val-set_fixed_buffer"><code>set_fixed_buffer</code></a>, or a zero-length buffer if none is set.</p></div></div><h3 id="queueing-operations"><a href="#queueing-operations" class="anchor"></a>Queueing operations</h3><div class="odoc-spec"><div class="spec value" id="val-noop" class="anchored"><a href="#val-noop" class="anchor"></a><code><span><span class="keyword">val</span> noop : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>noop t d</code> submits a no-op operation to uring <code>t</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p></div></div><h3 id="timeout"><a href="#timeout" class="anchor"></a>Timeout</h3><div class="odoc-spec"><div class="spec type" id="type-clock" class="anchored"><a href="#type-clock" class="anchor"></a><code><span><span class="keyword">type</span> clock</span><span> = </span></code><table><tr id="type-clock.Boottime" class="anchored"><td class="def variant constructor"><a href="#type-clock.Boottime" class="anchor"></a><code><span>| </span><span><span class="constructor">Boottime</span></span></code></td></tr><tr id="type-clock.Realtime" class="anchored"><td class="def variant constructor"><a href="#type-clock.Realtime" class="anchor"></a><code><span>| </span><span><span class="constructor">Realtime</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Represents Linux clocks. <code>Boottime</code> and <code>Realtime</code> represents OS clocks CLOCK_BOOTTIME and CLOCK_REALTIME respectively.</p><span class="comment-delim">*)</span></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-timeout" class="anchored"><a href="#val-timeout" class="anchor"></a><code><span><span class="keyword">val</span> timeout : <span>?absolute:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-clock">clock</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>timeout t clock ns d</code> submits a timeout request to uring <code>t</code>.</p><p><code>absolute</code> denotes how <code>clock</code> and <code>ns</code> relate to one another. Default value is <code>false</code></p><p><code>ns</code> is the timeout time in nanoseconds</p></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-FLAGS" class="anchored"><a href="#module-type-FLAGS" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-FLAGS/index.html">FLAGS</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Open_flags" class="anchored"><a href="#module-Open_flags" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Open_flags/index.html">Open_flags</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Flags that can be passed to openat2.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Resolve" class="anchored"><a href="#module-Resolve" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Resolve/index.html">Resolve</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Flags that can be passed to openat2 to control path resolution.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-openat2" class="anchored"><a href="#val-openat2" class="anchor"></a><code><span><span class="keyword">val</span> openat2 : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>access:<span>[ `R <span>| `W</span> <span>| `RW</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>flags:<a href="Open_flags/index.html#type-t">Open_flags.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>perm:<span class="xref-unresolved">Unix</span>.file_perm <span class="arrow">&#45;&gt;</span></span>
  <span>resolve:<a href="Resolve/index.html#type-t">Resolve.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?fd:<span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>openat2 t ~access ~flags ~perm ~resolve ~fd path d</code> opens <code>path</code>, which is resolved relative to <code>fd</code> (or the current directory if <code>fd</code> is not given). The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">access</span> <p>controls whether the file is opened for reading, writing, or both</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">flags</span> <p>are the usual open flags</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">perm</span> <p>sets the access control bits for newly created files (subject to the process's umask)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">resolve</span> <p>controls how the pathname is resolved.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-unlink" class="anchored"><a href="#val-unlink" class="anchor"></a><code><span><span class="keyword">val</span> unlink : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>dir:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?fd:<span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>unlink t ~dir ~fd path</code> removes the directory entry <code>path</code>, which is resolved relative to <code>fd</code>. If <code>fd</code> is not given, then the current working directory is used. If <code>path</code> is a symlink, the link is removed, not the target.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">dir</span> <p>If <code>true</code>, this acts like <code>rmdir</code> (only removing empty directories). If <code>false</code>, it acts like <code>unlink</code> (only removing non-directories).</p></li></ul></div></div><div class="odoc-spec"><div class="spec module" id="module-Poll_mask" class="anchored"><a href="#module-Poll_mask" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Poll_mask/index.html">Poll_mask</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-poll_add" class="anchored"><a href="#val-poll_add" class="anchor"></a><code><span><span class="keyword">val</span> poll_add : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><a href="Poll_mask/index.html#type-t">Poll_mask.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>poll_add t fd mask d</code> will submit a <code>poll(2)</code> request to uring <code>t</code>. It completes and returns <code>d</code> when an event in <code>mask</code> is ready on <code>fd</code>.</p></div></div><div class="odoc-spec"><div class="spec type subst" id="type-offset" class="anchored"><a href="#type-offset" class="anchor"></a><code><span><span class="keyword">type</span> offset</span><span> := <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p>For files, give the absolute offset, or use <code>Optint.Int63.minus_one</code> for the current position. For sockets, use an offset of <code>Optint.Int63.zero</code> (<code>minus_one</code> is not allowed here).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>read t ~file_offset fd buf d</code> will submit a <code>read(2)</code> request to uring <code>t</code>. It reads from absolute <code>file_offset</code> on the <code>fd</code> file descriptor and writes the results into the memory pointed to by <code>buf</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>write t ~file_offset fd buf d</code> will submit a <code>write(2)</code> request to uring <code>t</code>. It writes to absolute <code>file_offset</code> on the <code>fd</code> file descriptor from the the memory pointed to by <code>buf</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-iov_max" class="anchored"><a href="#val-iov_max" class="anchor"></a><code><span><span class="keyword">val</span> iov_max : int</span></code></div><div class="spec-doc"><p>The maximum length of the list that can be passed to <code>readv</code> and similar.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-readv" class="anchored"><a href="#val-readv" class="anchor"></a><code><span><span class="keyword">val</span> readv : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>readv t ~file_offset fd iov d</code> will submit a <code>readv(2)</code> request to uring <code>t</code>. It reads from absolute <code>file_offset</code> on the <code>fd</code> file descriptor and writes the results into the memory pointed to by <code>iov</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p><p>Requires <code>List.length iov &lt;= Uring.iov_max</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-writev" class="anchored"><a href="#val-writev" class="anchor"></a><code><span><span class="keyword">val</span> writev : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>writev t ~file_offset fd iov d</code> will submit a <code>writev(2)</code> request to uring <code>t</code>. It writes to absolute <code>file_offset</code> on the <code>fd</code> file descriptor from the the memory pointed to by <code>iov</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p><p>Requires <code>List.length iov &lt;= Uring.iov_max</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_fixed" class="anchored"><a href="#val-read_fixed" class="anchor"></a><code><span><span class="keyword">val</span> read_fixed : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span>off:int <span class="arrow">&#45;&gt;</span></span>
  <span>len:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>read t ~file_offset fd ~off ~len d</code> will submit a <code>read(2)</code> request to uring <code>t</code>. It reads up to <code>len</code> bytes from absolute <code>file_offset</code> on the <code>fd</code> file descriptor and writes the results into the fixed memory buffer associated with uring <code>t</code> at offset <code>off</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_chunk" class="anchored"><a href="#val-read_chunk" class="anchor"></a><code><span><span class="keyword">val</span> read_chunk : 
  <span>?len:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Region/index.html#type-chunk">Region.chunk</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>read_chunk</code> is like <code>read_fixed</code>, but gets the offset from <code>chunk</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">len</span> <p>Restrict the read to the first <code>len</code> bytes of <code>chunk</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-write_fixed" class="anchored"><a href="#val-write_fixed" class="anchor"></a><code><span><span class="keyword">val</span> write_fixed : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span>off:int <span class="arrow">&#45;&gt;</span></span>
  <span>len:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>write t ~file_offset fd off d</code> will submit a <code>write(2)</code> request to uring <code>t</code>. It writes up to <code>len</code> bytes into absolute <code>file_offset</code> on the <code>fd</code> file descriptor from the fixed memory buffer associated with uring <code>t</code> at offset <code>off</code>. The user data <code>d</code> will be returned by <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a> upon completion.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_chunk" class="anchored"><a href="#val-write_chunk" class="anchor"></a><code><span><span class="keyword">val</span> write_chunk : 
  <span>?len:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>file_offset:<a href="#type-offset">offset</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Region/index.html#type-chunk">Region.chunk</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>write_chunk</code> is like <code>write_fixed</code>, but gets the offset from <code>chunk</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">len</span> <p>Restrict the write to the first <code>len</code> bytes of <code>chunk</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-splice" class="anchored"><a href="#val-splice" class="anchor"></a><code><span><span class="keyword">val</span> splice : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>src:<span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span>dst:<span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span>len:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>splice t ~src ~dst ~len d</code> will submit a request to copy <code>len</code> bytes from <code>src</code> to <code>dst</code>. The operation returns the number of bytes transferred, or 0 for end-of-input. The result is <code>EINVAL</code> if the file descriptors don't support splicing.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-connect" class="anchored"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>connect t fd addr d</code> will submit a request to connect <code>fd</code> to <code>addr</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Sockaddr" class="anchored"><a href="#module-Sockaddr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sockaddr/index.html">Sockaddr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Holder for the peer's address in <a href="#val-accept"><code>accept</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-accept" class="anchored"><a href="#val-accept" class="anchor"></a><code><span><span class="keyword">val</span> accept : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><a href="Sockaddr/index.html#type-t">Sockaddr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>accept t fd addr d</code> will submit a request to accept a new connection on <code>fd</code>. The new FD will be configured with <code>SOCK_CLOEXEC</code>. The remote address will be stored in <code>addr</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cancel" class="anchored"><a href="#val-cancel" class="anchor"></a><code><span><span class="keyword">val</span> cancel : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>cancel t job d</code> submits a request to cancel <code>job</code>. The cancel job itself returns 0 on success, or <code>ENOTFOUND</code> if <code>job</code> had already completed by the time the kernel processed the cancellation request.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if the job has already been returned by e.g. <code>wait</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec module" id="module-Msghdr" class="anchored"><a href="#module-Msghdr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Msghdr/index.html">Msghdr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-send_msg" class="anchored"><a href="#val-send_msg" class="anchor"></a><code><span><span class="keyword">val</span> send_msg : 
  <span>?fds:<span><span class="xref-unresolved">Unix</span>.file_descr list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?dst:<span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>send_msg t fd buffs d</code> will submit a <code>sendmsg(2)</code> request. The <code>Msghdr</code> will be constructed from the FDs (<code>fds</code>), address (<code>dst</code>) and buffers (<code>buffs</code>).</p><p>Requires <code>List.length buffs &lt;= Uring.iov_max</code></p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">dst</span> <p>Destination address.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fds</span> <p>Extra file descriptors to attach to the message.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-recv_msg" class="anchored"><a href="#val-recv_msg" class="anchor"></a><code><span><span class="keyword">val</span> recv_msg : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><a href="Msghdr/index.html#type-t">Msghdr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-job">job</a></span> option</span></span></code></div><div class="spec-doc"><p><code>recv_msg t fd msghdr d</code> will submit a <code>recvmsg(2)</code> request. If the request is successful then the <code>msghdr</code> will contain the sender address and the data received.</p></div></div><h3 id="probing"><a href="#probing" class="anchor"></a>Probing</h3><p>You can check which operations are supported by the running kernel.</p><div class="odoc-spec"><div class="spec module" id="module-Op" class="anchored"><a href="#module-Op" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Op/index.html">Op</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-probe" class="anchored"><a href="#type-probe" class="anchor"></a><code><span><span class="keyword">type</span> probe</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-get_probe" class="anchored"><a href="#val-get_probe" class="anchor"></a><code><span><span class="keyword">val</span> get_probe : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-probe">probe</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-op_supported" class="anchored"><a href="#val-op_supported" class="anchor"></a><code><span><span class="keyword">val</span> op_supported : <span><a href="#type-probe">probe</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Op/index.html#type-t">Op.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h3 id="submitting-operations"><a href="#submitting-operations" class="anchor"></a>Submitting operations</h3><div class="odoc-spec"><div class="spec value" id="val-submit" class="anchored"><a href="#val-submit" class="anchor"></a><code><span><span class="keyword">val</span> submit : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>submit t</code> will submit all the outstanding queued requests on uring <code>t</code> to the kernel. Their results can subsequently be retrieved using <a href="#val-wait"><code>wait</code></a> or <a href="#val-peek"><code>peek</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-completion_option" class="anchored"><a href="#type-completion_option" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a completion_option</span></span><span> = </span></code><table><tr id="type-completion_option.None" class="anchored"><td class="def variant constructor"><a href="#type-completion_option.None" class="anchor"></a><code><span>| </span><span><span class="constructor">None</span></span></code></td></tr><tr id="type-completion_option.Some" class="anchored"><td class="def variant constructor"><a href="#type-completion_option.Some" class="anchor"></a><code><span>| </span><span><span class="constructor">Some</span> <span class="keyword">of</span> </span><span>{</span></code><table><tr id="type-completion_option.result" class="anchored"><td class="def record field"><a href="#type-completion_option.result" class="anchor"></a><code><span>result : int;</span></code></td></tr><tr id="type-completion_option.data" class="anchored"><td class="def record field"><a href="#type-completion_option.data" class="anchor"></a><code><span>data : <span class="type-var">'a</span>;</span></code></td></tr></table><code><span>}</span></code></td></tr></table></div><div class="spec-doc"><p>The type of results of calling <a href="#val-wait"><code>wait</code></a> and <a href="#val-peek"><code>peek</code></a>. <code>None</code> denotes that either there were no completions in the queue or an interrupt / timeout occurred. <code>Some</code> contains both the user data attached to the completed request and the integer syscall result.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wait" class="anchored"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span>?timeout:float <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-completion_option">completion_option</a></span></span></code></div><div class="spec-doc"><p><code>wait ?timeout t</code> will block indefinitely (the default) or for <code>timeout</code> seconds for any outstanding events to complete on uring <code>t</code>. This calls <a href="#val-submit"><code>submit</code></a> automatically.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_cqe_nonblocking" class="anchored"><a href="#val-get_cqe_nonblocking" class="anchor"></a><code><span><span class="keyword">val</span> get_cqe_nonblocking : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-completion_option">completion_option</a></span></span></code></div><div class="spec-doc"><p><code>get_cqe_nonblocking t</code> returns the next completion entry from the uring <code>t</code>. It is like <a href="#val-wait"><code>wait</code></a> except that it returns <code>None</code> instead of blocking.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-peek" class="anchored"><a href="#val-peek" class="anchor"></a><code><span><span class="keyword">val</span> peek : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-completion_option">completion_option</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-error_of_errno" class="anchored"><a href="#val-error_of_errno" class="anchor"></a><code><span><span class="keyword">val</span> error_of_errno : <span>int <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.error</span></code></div><div class="spec-doc"><p><code>error_of_errno e</code> converts the error code <code>abs e</code> to a Unix error type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-active_ops" class="anchored"><a href="#val-active_ops" class="anchor"></a><code><span><span class="keyword">val</span> active_ops : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>active_ops t</code> returns the number of operations added to the ring (whether submitted or not) for which the completion event has not yet been collected.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Stats" class="anchored"><a href="#module-Stats" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stats/index.html">Stats</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-get_debug_stats" class="anchored"><a href="#val-get_debug_stats" class="anchor"></a><code><span><span class="keyword">val</span> get_debug_stats : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="Stats/index.html#type-t">Stats.t</a></span></code></div><div class="spec-doc"><p><code>get_debug_stats t</code> collects some metrics about the internal state of <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Private" class="anchored"><a href="#module-Private" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Private/index.html">Private</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>